---
title: "Better FAFSA New Tables"
format:
  html:
    code-fold: true
    theme: solar
    embed-resources: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
library(knitr)
library(dplyr)

# Set directories
project_dir  <- "/home/erik/Repos/fafsa"
tables_dir   <- file.path(project_dir, "tables")
```

# Summary Statistics

## Table 1: Summary Statistics by Dependency Status

```{r table1}
summary_tables <- readRDS(file.path(tables_dir, "summary_tables.Rds"))
kable(summary_tables$Table1, 
      caption = "Summary statistics for all applicants, dependent students, and independent students",
      align = c('l', 'c', 'c', 'c'))
```

## Appendix Table A1: Summary Statistics by Year

```{r tableA1}
kable(summary_tables$TableA1,
      caption = "Summary statistics by application year (2021-2024)",
      align = c('l', 'c', 'c', 'c', 'c'))
```

# Changes in Total Submissions

## Appendix Table A2: Percent Change in Submissions (2023-24 to 2024-25)

```{r tableA2}
tableA2 <- readRDS(file.path(tables_dir, "tableA2.Rds"))
kable(tableA2,
      caption = "Percent change in total FAFSA submissions from 2023-24 to 2024-25 by applicant characteristics",
      digits = 3,
      align = c('l', 'r', 'r', 'r', 'r'))
```

# Regression Results: Refiling Outcomes

## Table 2: Changes in Refiling Outcomes by Education Level and Dependency Status

### Panel A: By Education Level - FAFSA Refiling (by March 25)

```{r table2-panelA-app}
table2 <- readRDS(file.path(tables_dir, "table2.Rds"))
kable(table2$Panel_A_app_next,
      caption = "Changes in FAFSA refiling rates by March 25, by education level",
      align = c('l', 'c', 'c', 'c', 'c'))
```

### Panel A: By Education Level - Cal Grant Refiling

```{r table2-panelA-cal}
kable(table2$Panel_A_cal_next,
      caption = "Changes in Cal Grant refiling rates, by education level",
      align = c('l', 'c', 'c', 'c', 'c'))
```

### Panel B: By Dependency Status - FAFSA Refiling (by March 25)

```{r table2-panelB-app}
kable(table2$Panel_B_app_next,
      caption = "Changes in FAFSA refiling rates by March 25, by dependency status",
      align = c('l', 'c', 'c', 'c'))
```

### Panel B: By Dependency Status - Cal Grant Refiling

```{r table2-panelB-cal}
kable(table2$Panel_B_cal_next,
      caption = "Changes in Cal Grant refiling rates, by dependency status",
      align = c('l', 'c', 'c', 'c'))
```

## Table 3: Changes in Refiling Outcomes by Tercile of Predicted Refiling

### FAFSA Refiling (by March 25)

```{r table3-app}
table3 <- readRDS(file.path(tables_dir, "table3.Rds"))
kable(table3$app_next,
      caption = "Changes in FAFSA refiling rates by March 25, by tercile of predicted refiling probability",
      align = c('l', 'c', 'c', 'c'))
```

### Cal Grant Refiling

```{r table3-cal}
kable(table3$cal_next,
      caption = "Changes in Cal Grant refiling rates, by tercile of predicted refiling probability",
      align = c('l', 'c', 'c', 'c'))
```

## Table 4: Changes in Refiling, Payment, and Enrollment Outcomes by College Sector

### Panel A: Refiling Outcomes - FAFSA Refiling (by March 25)

```{r table4-panelA-app}
table4 <- readRDS(file.path(tables_dir, "table4.Rds"))
kable(table4$Panel_A_app_next,
      caption = "Changes in FAFSA refiling rates by March 25, by college sector",
      align = c('l', 'c', 'c', 'c'))
```

### Panel A: Refiling Outcomes - Cal Grant Refiling

```{r table4-panelA-cal}
kable(table4$Panel_A_cal_next,
      caption = "Changes in Cal Grant refiling rates, by college sector",
      align = c('l', 'c', 'c', 'c'))
```

### Panel B: Payment Outcomes

```{r table4-panelB}
kable(table4$Panel_B_paid,
      caption = "Changes in state aid receipt, by college sector",
      align = c('l', 'c', 'c', 'c'))
```

### Panel C: Enrollment Outcomes

```{r table4-panelC}
kable(table4$Panel_C_enr,
      caption = "Changes in enrollment continuity, by college sector",
      align = c('l', 'c', 'c', 'c'))
```

# Enrollment Continuity

## Table 5: Changes in Enrollment Outcomes by Education Level and Dependency Status

### Panel A: By Education Level

```{r table5-panelA}
table5 <- readRDS(file.path(tables_dir, "table5.Rds"))
kable(table5$Panel_A,
      caption = "Changes in enrollment continuity by education level",
      align = c('l', 'c', 'c', 'c'))
```

### Panel B: By Dependency Status

```{r table5-panelB}
kable(table5$Panel_B,
      caption = "Changes in enrollment continuity by dependency status",
      align = c('l', 'c', 'c'))
```

# Appendix: Logistic Regression Model

## Appendix Table A3: Logistic Regression Predicting FAFSA Refiling in 2021

```{r tableA3}
tableA3_output <- readRDS(file.path(tables_dir, "tableA3_logit_model.Rds"))

# Display formatted table
kable(tableA3_output$formatted_table %>% 
        select(Variable, Formatted_Coef, Formatted_SE) %>%
        rename(Coefficient = Formatted_Coef,
               `Std. Error` = Formatted_SE),
      caption = paste0("Logistic regression predicting FAFSA refiling in 2021 (N = ", 
                      format(tableA3_output$n_observations, big.mark = ","), ")"),
      align = c('l', 'r', 'r'))
```
